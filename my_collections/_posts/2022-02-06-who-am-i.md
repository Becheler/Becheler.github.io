---
layout: post
title: I ain't much, but it's honest work
date: 2022-02-06 14:45
description: A (slightly) more formal introduction to my research
img: doodles/i-aint-much.png # Add image post (optional)
fig-caption: I ain't much, but it's honest work  # Add figcaption (optional)
tags: [ecology, evolution, biogeography, coalescence, quetzal]
sticky: true
---

You know, when I'm not doodling or messing around, I'm something of a scientist myself... :trollface:

:seedling: Long time ago I went to a landscaping school to be a gardener :blossom::tulip::rose:.

But, as it appeared later,
landscaping was much more about the mechanic of wooden materials or
the exact grocery list of what a lettuce eats in a day than just about planting flowers,
helping seeds grow and making our French landscapes green again.
Plus, I had no idea what to plant that could withstand climate change projections for 2050 anyway :sweat_smile:

So, in the middle of an Irish farm field somewhere between Kilkennny and Waterford, looking at a starflower and surrounded by 300 chickens, I decided I was done with practical applications
of agro-ecological concepts, and I went to study the theoretical stuff in Bordeaux, Salamanca, Montpellier, Paris and finally ... ze Michigan!

But landscaping never really left me :smirk_cat:

Today, spatiality (that is, the effects of space on processes, interactions, organisms and theories) can be found in at every level of my work.
From the most conceptual questions to the statistical methods, and even in some of the most
intricate (and, let's face it, obscure) line of code I write. Let me show you how.

--------------------------------------

## My discipline: Statistical Phylogeography

My research is rooted in *phylogeography*, the study of how past processes
have shaped the present spatial distribution of genetic lineages (within and among closely related species).

By *past processes*, I mean historical or geological events, such as:
- :small_airplane: Artificial dispersal of species (non-indigenous, naturalised or invasive)
- :desert_island: Sea level change (impacting species that live in and around islands systems)
- :mountain_snow: Dynamics of glaciers (impacting alpine plants that live on the periphery of these glaciers)
- :sun_behind_small_cloud: Climatic fluctuations (impacting e.g. species in the [campos rupestres](https://en.wikipedia.org/wiki/Campos_rupestres), beautiful Brazilian sky-islands)

> :hourglass_flowing_sand: These questions are of fundamental importance, and have sometimes a more urging tonality. For example, it is estimated that despite representing only 1% of Brazil's area, campos rupestres shelter around 15% of Brazil's plants diversity, and about 70% of all species in the Velloziaceae and Eriocaulaceae families! But global warming already pressures these sky-islands, and understanding their past dynamics could help us if or how their species will survive climate change :worried: I don't study these systems (although I find them super cool) but my colleague [Cecilia Fiorini](https://ceciliafiorini.weebly.com/) does!

:crystal_ball: If I can come with a bunch of models that can generate lineages under some versions of these scenarios, then I can compare them to the observed lineages in a statistical framework, and objectively decide what model is the best supported (that is, what historical scenario has the most likely happened to my data).

Often I don't know some details of these models with precision and so I try to estimate them in a Bayesian framework. When working with complex landscapes thee is not much you can mathematically do, so I use simulation-based inference methods.

:books: For an introduction to statistical phylogeography, check [this cool review by L. L. Knowles (2009).](https://www.annualreviews.org/doi/pdf/10.1146/annurev.ecolsys.38.091206.095702)

--------------------------------------------------

## My field: iDDC modeling

This term was coined in 2013 by [Qixin He](https://www.qixinhe.net/) to differentiate this line of work from previous spatially explicit methods that did not.

:books:  For a great review of iDDC modeling, go read  [this article by Dennis J. Larsson, Da Pan and Gerald M. Schneeweiss!](https://www.annualreviews.org/doi/pdf/10.1146/annurev.ecolsys.38.091206.095702)

#### :tada: - I liiike ... I-ntegrated!

Fundamentally, iDDC modeling recycles some of the best spatial methods in Ecology and Evolution,
and blends them into an approach that can keep up with the intimidating scales and inferential challenges of phylogeogaphic questions.

:man_cook: The not-so-secret ingredients of the iDDC recipe
are unveiled by its name:

- **Integrated**
- **Distributional**
- **Demographic** *and*
- **Coalescence** *modeling*.


#### :tada: - D liiike ... Environmental Niche Modeling! :thinking: Wait a minute...

Indeed! *Environmental Niche models* (**ENMs**) also go by the sweet name of *Species Distribution Models* (**SDMs**).

> :bulb: These models use presence/absence data of a species to draw correlations between longitude, latitude and the value of some environmental variables at these locations. The end result generally consists of some prediction of the **habitat suitability** over the landscape.  

![GBIF observational data and Digital Elevation Model]({{site.baseurl}}/assets/img/animations/animation_dem_gbif_3D.gif.gif)

I use these **suitability maps** to inform parameters of my demographic models. I can for example decide that the growth rate will be twice the suitability, and the carrying capacity ten times the suitability. *Or actually any other arbitrary function.*

This is super important for several reasons:

1. It decreases the number of parameters in my model by several orders of magnitude.
     > For example, instead of having 100.000 parameters (1 for each of your 100.000 demes) there is only 1 parameter for the whole landscape, rescaled 100.000 times by the value of each deme in the suitability map. Quite smart!

2. It really helps me constraining (guiding) the demographic history.
    > If you ever played [John Conway's Game of Life](https://playgameoflife.com/), you know how far can random walkers go... Suitability maps have been used to inform **friction maps** to constrain movements in the landscape.

3. It's a cheap way to time travel: it helps me building some sense of past species distributions. Using high resolution paleoclimatic reconstructions like [CHELSA-Trace21k](https://chelsa-climate.org/chelsa-trace21k/) I can even extrapolate the habitat suitability to the Last Glacial Maximum!
    > :expressionless: suspicious? You can always test the robustness of these reconstructions! :wink:)

#### :tada: - Another D liiike ... D-emographic!

At phylogeographic scales, it's not really feasible
to simulate individuals and their genetics from the past to the present. That would be way too slow. Instead, I proceed in two steps:

1. A **time-forward**, simplified demographic simulation  
2. A **time-backward** simulation of the sampled lineages dynamics (their *coalescence*) in this demographic simulation

:cook_man: The demographic simulation step is the best moment for me to inject some custom flavor into the iDDC recipe, resulting in a closer match to my biological system: even at these scales, a snail is still quite different from an owl,
a fox or a starflower- and acts as such.

#### :tada: - C liiike ... C-oalescence!

*Ahlala*, coalescence: the nightmare of every grad student. It took me a PhD and countless sleepless nights to understand maybe 1% of this theory.

Fundamentally, it's just a way to represent the dynamics of lineages in a population. Concretely, the fact that the theory describes this dynamics *backward in time* can be freaking confusing :face_with_head_bandage:

But it is actually very elegant, and super efficient in terms of simulation. You just start with the lineages from your sample, and you ask the question of where these lineages could have been one generation before.
- Since you just run a demographic simulation, you can use the effective migration flows to inform this process: that's the *backward migration* of lineages.
- Sometimes some lineages will *coalesce*: that means your sample just found a possible common ancestor.

:game_die: Again, it's a probabilistic model: maybe that this common ancestor does not really reflect your data, maybe the migration patterns are way off, and so maybe this demographic simulation is not the best candidate and should be discarded. Rejection of bad simulations is a key aspect of simulation-based inference.

----------------------------------------

## :rocket: My mission, should I choose to accept it: make iDDC inference widely accessible!

In the same way that you don't use a scooter to fly
to the moon, you have to come up with a pretty good engine if you want to look back at the
spatial dynamics of a species over thousands of years.

The problem is, until recently we did not really have an iDDC engine. We had some blueprints and general directions from previous researches, and a 20 years old blackbox, closed source simulator [Splatche](https://www.splatche.com/splatche3).

The situation was a bit equivalent to trying to retro-engineer Apollo 11 when all you have is a blurry photography of the launch: no engineer, no toolbox, no components, no raw materials either, no industry, no factory. With no tools to push the limits of science, no wonder why iDDC stagnated for so long!

So I decided to build these tools and components. It was a weird experience, because you end up trying to convince people they need to buy your bricks to build a nice house when everybody is used to live in a rock-cut cave!

:man_mechanic: With the trust of my successive PIs, and the advice of developers, I ended up designing the Quetzal framework: a suite of toolboxes of increasing granularity that offer a modeling/simulation/inference capability!

We have now:
1. Quetzal-CoaTL: a C++ library with reusable components to build iDDC simulators
2. Quetal-EGGS: the growing list of iDDC simulators
3. Quetzal-CRUMBS: a python library that wraps most of the iDDC steps (get paleoclimatic data, get observational data, do geospatial stuff, perform SDM...)
4. Quetzal-NEST: a Docker container that contains all the numerous dependencies for reproducible research: you can even use it to run computations on clusters (e.g., Open Science Grid)

![]({{site.baseurl}}/assets/img/schemes/pipeline_SOFTWARES.svg)


-------------------------

# :books: References

* Knowles, L. L. (2009). Statistical phylogeography. Annual Review of Ecology, Evolution, and Systematics, 40, 593-612

* Larsson, D. J., Pan, D., & Schneeweiss, G. M. (2021). Addressing alpine plant phylogeography using integrative distributional, demographic and coalescent modeling. Alpine Botany, 1-15.

<div class=my_figure>
  <p><img class=scaled src="{{site.baseurl}}/assets/img/animations/dem_dynamic_2D.gif"
    alt="Digital Elevation Model">
  <p>Elevation above sea level in North Australia, from -5000y to today. If you think THIS did not impact the lifestyle of my insular little geckos, well... prove it with stats :kissing_smiling_eyes:
</div>
