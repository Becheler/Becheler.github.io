This section of the \href{../../../pages/quetzal/home}{\texttt{ Quetzal website}} is meant for C++ developers who want to include the library in their own code project.

Here are two snippets of code that can illustrate the use of Quetzal A\+PI\hypertarget{index_autotoc_md1}{}\doxysection{Mass based simulation with migration towards neighbors}\label{index_autotoc_md1}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "\mbox{\hyperlink{quetzal_8h}{quetzal/quetzal.h}}"}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <boost/math/special\_functions/binomial.hpp>} \textcolor{comment}{// binomial coefficient}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Namespace shortnames}}
\DoxyCodeLine{\textcolor{keyword}{namespace }geo = \mbox{\hyperlink{namespacequetzal_1_1geography}{quetzal::geography}};}
\DoxyCodeLine{\textcolor{keyword}{namespace }schemes = \mbox{\hyperlink{namespacequetzal_1_1sampling__scheme}{quetzal::sampling\_scheme}};}
\DoxyCodeLine{\textcolor{keyword}{namespace }expr = \mbox{\hyperlink{namespacequetzal_1_1expressive}{quetzal::expressive}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Parameter 1 : path to geoTiff environmental dataset}}
\DoxyCodeLine{\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"0 ... Reading "} << argc << \textcolor{stringliteral}{" input parameters"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Initalize random number generator}}
\DoxyCodeLine{  std::random\_device rd;}
\DoxyCodeLine{  std::mt19937 gen(rd());}
\DoxyCodeLine{\textcolor{comment}{  /******************************}}
\DoxyCodeLine{\textcolor{comment}{  * Geospatial dataset}}
\DoxyCodeLine{\textcolor{comment}{  *****************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"1 ... Reading environment file "} << argv[1] << std::endl;}
\DoxyCodeLine{  \textcolor{keyword}{using} time\_type = int;}
\DoxyCodeLine{  \textcolor{keyword}{using} landscape\_type = geo::DiscreteLandscape<std::string,time\_type>;}
\DoxyCodeLine{  \textcolor{keyword}{using} coord\_type = landscape\_type::coord\_type;}
\DoxyCodeLine{  landscape\_type env( \{\{\textcolor{stringliteral}{"temp"}, argv[1]\}\},   \{time\_type(0)\} );}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /******************************}}
\DoxyCodeLine{\textcolor{comment}{  * Simulator configuration}}
\DoxyCodeLine{\textcolor{comment}{  *****************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"2 ... Initializing spatial coalescence simulator"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Declaring simulation policies (policy-\/based design)}}
\DoxyCodeLine{  \textcolor{keyword}{using} demographic\_policy = \mbox{\hyperlink{classquetzal_1_1demography_1_1dispersal__policy_1_1mass__based}{quetzal::demography::dispersal\_policy::mass\_based}};}
\DoxyCodeLine{  \textcolor{keyword}{using} coalescence\_policy = \mbox{\hyperlink{classquetzal_1_1coalescence_1_1newick__with__distance__to__parent}{quetzal::coalescence::newick\_with\_distance\_to\_parent<coord\_type, time\_type>}};}
\DoxyCodeLine{  \textcolor{keyword}{using} simulator\_type = \mbox{\hyperlink{classquetzal_1_1ForwardBackwardSpatiallyExplicit}{quetzal::ForwardBackwardSpatiallyExplicit<coord\_type, demographic\_policy, coalescence\_policy>}};}
\DoxyCodeLine{  \textcolor{comment}{// Initial distribution}}
\DoxyCodeLine{  coord\_type x\_0 = env.reproject\_to\_centroid(coord\_type(40.0, -\/3.0));}
\DoxyCodeLine{  \textcolor{comment}{// Number of introduced gene copies}}
\DoxyCodeLine{  demographic\_policy::value\_type N\_0 = 100;}
\DoxyCodeLine{  \textcolor{comment}{// Number of generations}}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} t\_0 = 0;}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nb\_generations = 30;}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sampling\_time = 29;}
\DoxyCodeLine{  \textcolor{comment}{// Simulator initialization}}
\DoxyCodeLine{  simulator\_type simulator(x\_0, N\_0, nb\_generations);}
\DoxyCodeLine{  \textcolor{comment}{// Ancestral wright-\/fisher population size}}
\DoxyCodeLine{  simulator.ancestral\_Wright\_Fisher\_N(N\_0);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /******************************}}
\DoxyCodeLine{\textcolor{comment}{  * Niche and growth functions}}
\DoxyCodeLine{\textcolor{comment}{  *****************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"3 ... Initializing demographic growth niche functions"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// A literal factory is used to transforms literals into function of space and time}}
\DoxyCodeLine{  \textcolor{keyword}{using} expr::literal\_factory;}
\DoxyCodeLine{  \textcolor{keyword}{using} \mbox{\hyperlink{namespacequetzal_1_1expressive_acdec2cd4ec959709f7a1891702c4d5dd}{expr::use}};}
\DoxyCodeLine{  literal\_factory<coord\_type, time\_type> lit;}
\DoxyCodeLine{  \textcolor{comment}{// Growth rate is constant across space and time}}
\DoxyCodeLine{  \textcolor{keyword}{auto} r = lit(5);}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve temperature function of space (homogeneous across time)}}
\DoxyCodeLine{  \textcolor{keyword}{auto} temp = env[\textcolor{stringliteral}{"temp"}];}
\DoxyCodeLine{  \textcolor{comment}{// Wrap it to ignore time argument}}
\DoxyCodeLine{  \textcolor{keyword}{auto} s = [temp](coord\_type x, time\_type)\{\textcolor{keywordflow}{return} temp(x, 0) >= 0.0 ? temp(x,0) : 0.0 ;\};}
\DoxyCodeLine{  \textcolor{comment}{// Compose it to get a carrying capacity expression}}
\DoxyCodeLine{  \textcolor{keyword}{auto} K = \mbox{\hyperlink{namespacequetzal_1_1expressive_acdec2cd4ec959709f7a1891702c4d5dd}{use}}(s)*lit(5);}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve the population size functor}}
\DoxyCodeLine{  \textcolor{keyword}{auto} N = simulator.get\_functor\_N();}
\DoxyCodeLine{  \textcolor{comment}{// Compose everything in a logistic growth expression}}
\DoxyCodeLine{  \textcolor{keyword}{auto} logistic = N * ( lit(1) + r ) / ( lit(1) + ( (r * N)/K ));}
\DoxyCodeLine{  \textcolor{comment}{// Add random fluctuations}}
\DoxyCodeLine{  \textcolor{keyword}{auto} sim\_children = [logistic](\textcolor{keyword}{auto}\& gen, coord\_type \textcolor{keyword}{const}\&x, time\_type t)\{}
\DoxyCodeLine{    std::poisson\_distribution<unsigned int> poisson(logistic(x,t));}
\DoxyCodeLine{    \textcolor{keywordflow}{return} poisson(gen);}
\DoxyCodeLine{  \};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /******************}}
\DoxyCodeLine{\textcolor{comment}{  * Dispersal}}
\DoxyCodeLine{\textcolor{comment}{  ******************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"4 ... Initializing dispersal kernel"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Define an emigrant rate}}
\DoxyCodeLine{  \textcolor{keywordtype}{double} emigrant\_rate = 0.1;}
\DoxyCodeLine{  \textcolor{comment}{// Define the friction according to environmental features}}
\DoxyCodeLine{  \textcolor{keyword}{auto} is\_temp\_high = [temp](coord\_type x, time\_type)\{\textcolor{keywordflow}{return} temp(x, 0) >= 15.0 ? true : false ;\};}
\DoxyCodeLine{  \textcolor{keyword}{auto} friction = [is\_temp\_high](coord\_type \textcolor{keyword}{const}\& x)\{\textcolor{keywordflow}{return} is\_temp\_high(x,0) ? 0.3 : 0.7 ;\};}
\DoxyCodeLine{  \textcolor{comment}{// Capture an expression to find nearest neighbours}}
\DoxyCodeLine{  \textcolor{keyword}{auto} env\_ref = std::cref(env);}
\DoxyCodeLine{  \textcolor{keyword}{auto} get\_neighbors = [env\_ref](coord\_type \textcolor{keyword}{const}\& x)\{\textcolor{keywordflow}{return} env\_ref.get().direct\_neighbors(x);\};}
\DoxyCodeLine{  \textcolor{comment}{// Build a dispersal kernel object}}
\DoxyCodeLine{  \textcolor{keyword}{auto} dispersal = demographic\_policy::make\_neighboring\_migration(coord\_type(), emigrant\_rate, friction, get\_neighbors);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /**************************}}
\DoxyCodeLine{\textcolor{comment}{  * Demographic expansion}}
\DoxyCodeLine{\textcolor{comment}{  **************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"5 ... Simulating demographic expansion"} << std::endl;}
\DoxyCodeLine{  simulator.simulate\_forward\_demography(sim\_children, dispersal, gen);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /************************************************************}}
\DoxyCodeLine{\textcolor{comment}{  *  Sample uniformely at random across the distribution area}}
\DoxyCodeLine{\textcolor{comment}{  ************************************************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"6 ... Simulating sampling scheme"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Declare sampling size}}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = 50;}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve the non-\/empty demes at sampling time}}
\DoxyCodeLine{  std::vector<coord\_type> distribution\_area = simulator.distribution\_area(sampling\_time);}
\DoxyCodeLine{  \textcolor{comment}{// Declare a functor to get the population size at sampling time}}
\DoxyCodeLine{  \textcolor{keyword}{auto} last\_N = [N, sampling\_time](coord\_type \textcolor{keyword}{const}\& x)\{\textcolor{keywordflow}{return} N(x, sampling\_time);\};}
\DoxyCodeLine{  \textcolor{comment}{// Give the required information to the sampling scheme simulator}}
\DoxyCodeLine{  \textcolor{keyword}{auto} unif\_sampler = \mbox{\hyperlink{namespacequetzal_1_1sampling__scheme_a7bac808766a423246a21e1c3bfd35f6f}{quetzal::sampling\_scheme::make\_unif\_constrained\_sampler}}(distribution\_area, last\_N, n);}
\DoxyCodeLine{  \textcolor{comment}{// Generate a random sample}}
\DoxyCodeLine{  \textcolor{keyword}{auto} sample = unif\_sampler(gen);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /**********************}}
\DoxyCodeLine{\textcolor{comment}{  *  Data visualization}}
\DoxyCodeLine{\textcolor{comment}{  **********************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"7 ... Exporting GIS data for visualization"} << std::endl;}
\DoxyCodeLine{  std::string N\_filename = \textcolor{stringliteral}{"N.tif"};}
\DoxyCodeLine{  \textcolor{comment}{// Make it easy to visualize using eg the R package raster}}
\DoxyCodeLine{  env.export\_to\_geotiff(N, t\_0, sampling\_time, [\&simulator](time\_type \textcolor{keyword}{const}\& t)\{\textcolor{keywordflow}{return} simulator.distribution\_area(t);\}, N\_filename);}
\DoxyCodeLine{  \textcolor{comment}{// Easy to visualize with eg readOGR R function}}
\DoxyCodeLine{  env.export\_to\_shapefile(sample, \textcolor{stringliteral}{"sample.shp"});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{  /**********************}}
\DoxyCodeLine{\textcolor{comment}{  *  Coalescence}}
\DoxyCodeLine{\textcolor{comment}{  **********************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"8 ... Begining coalescence"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Coalesce sampled gene copies aaaaall the way to the MRCA}}
\DoxyCodeLine{  \textcolor{keyword}{auto} results = simulator.coalesce\_to\_mrca<>(sample, sampling\_time, gen);}
\DoxyCodeLine{  \textcolor{comment}{// Output trees newick formulas}}
\DoxyCodeLine{  std::ofstream file;}
\DoxyCodeLine{  file.open (\textcolor{stringliteral}{"trees.txt"});}
\DoxyCodeLine{  file << results;}
\DoxyCodeLine{  file.close();}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"Done"} << std::endl;}
\DoxyCodeLine{  \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}
\end{DoxyCodeInclude}
 \hypertarget{index_autotoc_md2}{}\doxysection{Individual based simulation with distance based (gaussian) kernel}\label{index_autotoc_md2}

\begin{DoxyCodeInclude}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "\mbox{\hyperlink{quetzal_8h}{quetzal/quetzal.h}}"}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <boost/math/special\_functions/binomial.hpp>} \textcolor{comment}{// binomial coefficient}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <algorithm>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <cassert>}}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Namespace shortnames}}
\DoxyCodeLine{\textcolor{keyword}{namespace }geo = \mbox{\hyperlink{namespacequetzal_1_1geography}{quetzal::geography}};}
\DoxyCodeLine{\textcolor{keyword}{namespace }schemes = \mbox{\hyperlink{namespacequetzal_1_1sampling__scheme}{quetzal::sampling\_scheme}};}
\DoxyCodeLine{\textcolor{keyword}{namespace }expr = \mbox{\hyperlink{namespacequetzal_1_1expressive}{quetzal::expressive}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// Parameter 1 : path to geoTiff environmental dataset}}
\DoxyCodeLine{\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char}* argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"0 ... Reading "} << argc << \textcolor{stringliteral}{" input parameters"} << std::endl;}
\DoxyCodeLine{\textcolor{comment}{  /******************************}}
\DoxyCodeLine{\textcolor{comment}{   * Geospatial dataset}}
\DoxyCodeLine{\textcolor{comment}{   *****************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"1 ... Reading environment file "} << argv[1] << std::endl;}
\DoxyCodeLine{  \textcolor{keyword}{using} time\_type = int;}
\DoxyCodeLine{  \textcolor{keyword}{using} landscape\_type = geo::DiscreteLandscape<std::string,time\_type>;}
\DoxyCodeLine{  \textcolor{keyword}{using} coord\_type = landscape\_type::coord\_type;}
\DoxyCodeLine{  landscape\_type env( \{\{\textcolor{stringliteral}{"temp"}, argv[1]\}\},   \{time\_type(0)\} );}
\DoxyCodeLine{\textcolor{comment}{  /******************************}}
\DoxyCodeLine{\textcolor{comment}{   * Simulator configuration}}
\DoxyCodeLine{\textcolor{comment}{   *****************************/}}
\DoxyCodeLine{   std::cout << \textcolor{stringliteral}{"2 ... Initializing spatial coalescence simulator"} << std::endl;}
\DoxyCodeLine{  \textcolor{keyword}{using} demographic\_policy = \mbox{\hyperlink{classquetzal_1_1demography_1_1dispersal__policy_1_1individual__based}{quetzal::demography::dispersal\_policy::individual\_based}};}
\DoxyCodeLine{  \textcolor{keyword}{using} coalescence\_policy = \mbox{\hyperlink{classquetzal_1_1coalescence_1_1newick__with__distance__to__parent}{quetzal::coalescence::newick\_with\_distance\_to\_parent<coord\_type, time\_type>}};}
\DoxyCodeLine{  \textcolor{keyword}{using} simulator\_type = \mbox{\hyperlink{classquetzal_1_1ForwardBackwardSpatiallyExplicit}{quetzal::ForwardBackwardSpatiallyExplicit<coord\_type, demographic\_policy, coalescence\_policy>}};}
\DoxyCodeLine{  \textcolor{comment}{// Initial distribution}}
\DoxyCodeLine{  coord\_type x\_0 = env.reproject\_to\_centroid(coord\_type(40.0, -\/3.0));}
\DoxyCodeLine{  \textcolor{comment}{// Number of introduced gene copies}}
\DoxyCodeLine{  demographic\_policy::value\_type N\_0 = 100;}
\DoxyCodeLine{  \textcolor{comment}{// Number of generations}}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} t\_0 = 0;}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nb\_generations = 30;}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} sampling\_time = 29;}
\DoxyCodeLine{  \textcolor{comment}{// Simulator initialization}}
\DoxyCodeLine{  simulator\_type simulator(x\_0, N\_0, nb\_generations);}
\DoxyCodeLine{  \textcolor{comment}{// Ancestral wright-\/fisher population size}}
\DoxyCodeLine{  simulator.ancestral\_Wright\_Fisher\_N(N\_0);}
\DoxyCodeLine{  \textcolor{comment}{// Sampling size}}
\DoxyCodeLine{  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = 50;}
\DoxyCodeLine{\textcolor{comment}{  /******************************}}
\DoxyCodeLine{\textcolor{comment}{   * Niche and growth functions}}
\DoxyCodeLine{\textcolor{comment}{   *****************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"3 ... Initializing demographic growth niche functions"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// A literal factory is used to transforms literals into function of space and time}}
\DoxyCodeLine{  \textcolor{keyword}{using} expr::literal\_factory;}
\DoxyCodeLine{  \textcolor{keyword}{using} \mbox{\hyperlink{namespacequetzal_1_1expressive_acdec2cd4ec959709f7a1891702c4d5dd}{expr::use}};}
\DoxyCodeLine{  literal\_factory<coord\_type, time\_type> lit;}
\DoxyCodeLine{  \textcolor{comment}{// Growth rate is constant across space and time}}
\DoxyCodeLine{  \textcolor{keyword}{auto} r = lit(5);}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve temperature function of space (homogeneous across time)}}
\DoxyCodeLine{  \textcolor{keyword}{auto} temp = env[\textcolor{stringliteral}{"temp"}];}
\DoxyCodeLine{  \textcolor{comment}{// Wrap it to ignore time argument}}
\DoxyCodeLine{  \textcolor{keyword}{auto} s = [temp](coord\_type x, time\_type)\{\textcolor{keywordflow}{return} temp(x, 0) >= 0.0 ? temp(x,0) : 0.0 ;\};}
\DoxyCodeLine{  \textcolor{comment}{// Compose it to get a carrying capacity expression}}
\DoxyCodeLine{  \textcolor{keyword}{auto} K = \mbox{\hyperlink{namespacequetzal_1_1expressive_acdec2cd4ec959709f7a1891702c4d5dd}{use}}(s)*lit(5);}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve the population size function}}
\DoxyCodeLine{  \textcolor{keyword}{auto} N = simulator.get\_functor\_N();}
\DoxyCodeLine{  \textcolor{comment}{// Compose everything in a logistic growth expression}}
\DoxyCodeLine{  \textcolor{keyword}{auto} g = N * ( lit(1) + r ) / ( lit(1) + ( (r * N)/K ));}
\DoxyCodeLine{  \textcolor{keyword}{auto} sim\_children = [g](\textcolor{keyword}{auto}\& gen, coord\_type \textcolor{keyword}{const}\&x, time\_type t)\{}
\DoxyCodeLine{    std::poisson\_distribution<unsigned int> poisson(g(x,t));}
\DoxyCodeLine{    \textcolor{keywordflow}{return} poisson(gen);}
\DoxyCodeLine{  \};}
\DoxyCodeLine{  \textcolor{comment}{// Initalize RNG}}
\DoxyCodeLine{  std::random\_device rd;}
\DoxyCodeLine{  std::mt19937 gen(rd());}
\DoxyCodeLine{\textcolor{comment}{  /******************}}
\DoxyCodeLine{\textcolor{comment}{   * Dispersal}}
\DoxyCodeLine{\textcolor{comment}{   ******************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"4 ... Initializing dispersal kernel"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve the demic structure}}
\DoxyCodeLine{  \textcolor{keyword}{auto} \textcolor{keyword}{const}\& demes = env.geographic\_definition\_space();}
\DoxyCodeLine{  \textcolor{comment}{// Build a dispersal kernel object}}
\DoxyCodeLine{  \textcolor{keyword}{using} \mbox{\hyperlink{structquetzal_1_1demography_1_1dispersal__kernel_1_1Gaussian}{quetzal::demography::dispersal\_kernel::Gaussian}};}
\DoxyCodeLine{  \textcolor{keyword}{auto} f = [](coord\_type \textcolor{keyword}{const}\& x, coord\_type \textcolor{keyword}{const}\& y)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} Gaussian::pdf(x.great\_circle\_distance\_to(y), Gaussian::param\_type(100.0));}
\DoxyCodeLine{  \};}
\DoxyCodeLine{  \textcolor{keyword}{auto} dispersal = demographic\_policy::make\_distance\_based\_dispersal(demes, f);}
\DoxyCodeLine{\textcolor{comment}{  /**************************}}
\DoxyCodeLine{\textcolor{comment}{  * Demographic expansion}}
\DoxyCodeLine{\textcolor{comment}{  **************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"5 ... Simulating demographic expansion"} << std::endl;}
\DoxyCodeLine{  simulator.simulate\_forward\_demography(sim\_children, dispersal, gen);}
\DoxyCodeLine{\textcolor{comment}{  /************************************************************}}
\DoxyCodeLine{\textcolor{comment}{  *  Sample uniformely at random across the distribution area}}
\DoxyCodeLine{\textcolor{comment}{  ************************************************************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"6 ... Simulating sampling scheme"} << std::endl;}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve the non-\/empty demes at sampling time}}
\DoxyCodeLine{  std::vector<coord\_type> distribution\_area = simulator.distribution\_area(sampling\_time);}
\DoxyCodeLine{  \textcolor{comment}{// Retrieve the last expression}}
\DoxyCodeLine{  \textcolor{keyword}{auto} last\_N = [N, sampling\_time](coord\_type \textcolor{keyword}{const}\& x)\{\textcolor{keywordflow}{return} N(x, sampling\_time);\};}
\DoxyCodeLine{  \textcolor{keyword}{auto} unif\_sampler = \mbox{\hyperlink{namespacequetzal_1_1sampling__scheme_a7bac808766a423246a21e1c3bfd35f6f}{quetzal::sampling\_scheme::make\_unif\_constrained\_sampler}}(distribution\_area, last\_N, n);}
\DoxyCodeLine{  \textcolor{keyword}{auto} sample = unif\_sampler(gen);}
\DoxyCodeLine{\textcolor{comment}{  /**********************}}
\DoxyCodeLine{\textcolor{comment}{   *  Data visualization}}
\DoxyCodeLine{\textcolor{comment}{   **********************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"7 ... Exporting GIS data for visualization"} << std::endl;}
\DoxyCodeLine{  std::string N\_filename = \textcolor{stringliteral}{"N.tif"};}
\DoxyCodeLine{  env.export\_to\_geotiff(N, t\_0, sampling\_time, [\&simulator](time\_type \textcolor{keyword}{const}\& t)\{\textcolor{keywordflow}{return} simulator.distribution\_area(t);\}, N\_filename);}
\DoxyCodeLine{  env.export\_to\_shapefile(sample, \textcolor{stringliteral}{"sample.shp"});}
\DoxyCodeLine{\textcolor{comment}{  /**********************}}
\DoxyCodeLine{\textcolor{comment}{   *  Coalescence}}
\DoxyCodeLine{\textcolor{comment}{   **********************/}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"8 ... Begining coalescence"} << std::endl;}
\DoxyCodeLine{  \textcolor{keyword}{auto} results = simulator.coalesce\_to\_mrca<>(sample, sampling\_time, gen);}
\DoxyCodeLine{  std::ofstream file;}
\DoxyCodeLine{  file.open (\textcolor{stringliteral}{"trees.txt"});}
\DoxyCodeLine{  file << results;}
\DoxyCodeLine{  file.close();}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"Done"} << std::endl;}
\DoxyCodeLine{  \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}
\end{DoxyCodeInclude}
