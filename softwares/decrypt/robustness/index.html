<!DOCTYPE html>
<html lang="en">

<!-- Include header -->
<head>
	<meta charset="utf-8">
	<title>Decrypt - Arnaud Becheler - Personal website</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Arnaud Becheler - Personal website" property="og:site_name">
  
    <meta content="Decrypt" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="application" property="og:description">
  
  
    <meta content="https://Becheler.github.io/softwares/decrypt/robustness/" property="og:url">
  
  
  
    <meta content="https://Becheler.github.io/assets/img/arnaud-becheler.png" property="og:image">
  
  
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="Decrypt">
  
  
    <meta name="twitter:url" content="https://Becheler.github.io/softwares/decrypt/robustness/">
  
  
    <meta name="twitter:description" content="application">
  
  
    <meta name="twitter:image:src" content="https://Becheler.github.io/assets/img/arnaud-becheler.png">
  

	<meta name="description" content="application">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700|Lato:300,400,700&display=swap" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/my-softwares.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
	<link rel="stylesheet" href="/assets/css/my_stylesheet.css">
	<!-- Tangerine font -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Tangerine:wght@700&display=swap" rel="stylesheet"> 
</head>


*<!-- Mathjax support -->

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>



<!-- Default body -->
<body>
  
  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/arnaud-becheler.png" alt="Arnaud Becheler"></a>
      </div>
      <div class="author-name">Arnaud Becheler</div>
      <p>A French Software Engineer, always happy to learn about phylogeography and programming!</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Softwares</h3>
      <ul>
        <li><a href="https://github.com/Becheler/quetzal-EGGS" target="_blank"><i class="icon icon-quetzal-eggs--fa" title="Quetzal-EGGS" aria-hidden="true"></i></a></li>
        <li><a href="/softwares/quetzal-CoalTL/home" target="_blank"><i class="icon icon-quetzal-coaltl-fa" title="Quetzal-CoalTL" aria-hidden="true"></i></a></li>
        <li><a href="https://github.com/Becheler/quetzal-CRUMBS" target="_blank"><i class="icon icon-quetzal-crumbs-fa" title="Quetzal-CRUMBS" aria-hidden="true"></i></a></li>
        <li><a href="https://github.com/Becheler/decrypt" target="_blank"><i class="icon icon-decrypt_fa" title="Decrypt" aria-hidden="true"></i></a></li>
      </ul>
      <section class="contact">
        <h3 class="contact-title"> About me </h3>
        <ul>
          <li><a href="/pages/about-me/index.html" target="_blank"><i class="fa fa-youtube-play" title="Presentations" aria-hidden="true"></i></a></li>
          <li><a href="/assets/pdfs/cv.pdf" target="_blank"><i class="fa fa-file-pdf-o" title="CV" aria-hidden="true"></i></a></li>
          <li><a href="https://scholar.google.fr/citations?user=zEwT-zUAAAAJ&hl=en&oi=ao" target="_blank"><i class="fa fa-graduation-cap" title="My Google Scholar" aria-hidden="true"></i></a></li>
          
        </ul>
    </section> <!-- End Section Resume -->
    <section class="contact">
      <h3 class="contact-title">Find me on</h3>
      <ul>
        
        
        
        
          <li class="github"><a href="http://github.com/" target="_blank"><i class="fa fa-github" aria-hidden="true"></i></a></li>
        
        
        
          <li class="linkedin"><a href="https://in.linkedin.com/" target="_blank"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2022 &copy; Arnaud Becheler</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <h1 id="sampling-scheme-under-decrypt">Sampling scheme under Decrypt</h1>

<p>In the current version, sampling schemes are quite simplistic. Each scheme is defined
by two clusters of individuals, defining two sampling populations $P_1$ and
$P_2$.</p>
<ul>
  <li>$P_1$, the red circle in the following picture, is fixed for all simulations at a user-defined location $(lon_1, lat_1)$.
At sampling time, $n_1$ gene copies are sampled uniformly in a radius $r_1$ around this
coordinate.</li>
  <li>$P_2$, white circle, is a population which location varies across simulations: it is uniformly sampled in the distribution
area. At sampling time, $n_2$ gene copies are sampled uniformly in a radius $r_1$.</li>
</ul>

<p><img src="../draw/decrypt_sampling_scheme.png" alt="alt text" title="Decrypt sampling scheme" /></p>

<h1 id="folder-structure">Folder structure</h1>

<p>This directory contains various folders:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">decrypt</code> a folder where the project has been installed along with several examples files</li>
  <li><code class="language-plaintext highlighter-rouge">decrypt/output</code> a temporary output folder to store simulations results</li>
  <li><code class="language-plaintext highlighter-rouge">decrypt/examples</code> a temporary output folder to store simulations results</li>
</ul>

<h2 id="example-configuration-files">Example configuration files</h2>

<p>The <code class="language-plaintext highlighter-rouge">sandbox/decrypt</code> folder contains:</p>
<ul>
  <li>an <code class="language-plaintext highlighter-rouge">examples</code> directory where you can find:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">australia_precipitation_6032.tif</code> a raster representing the rainfall in North Australia</li>
      <li><code class="language-plaintext highlighter-rouge">config_1.ctl</code> a configuration file for the <code class="language-plaintext highlighter-rouge">model_1</code> program</li>
      <li><code class="language-plaintext highlighter-rouge">config_2.ctl</code> a configuration file for the <code class="language-plaintext highlighter-rouge">model_2</code> program</li>
      <li><code class="language-plaintext highlighter-rouge">config_3.ctl</code> a configuration file for the <code class="language-plaintext highlighter-rouge">model_3</code> program</li>
      <li><code class="language-plaintext highlighter-rouge">bpp.ctl</code> a configuration file for BPP, not used in this demo</li>
      <li><code class="language-plaintext highlighter-rouge">data_extract</code> a bunch of output generated by decrypt that we pre-computed</li>
      <li><code class="language-plaintext highlighter-rouge">last_N.tif</code> a raster giving the spatial distribution of population sizes at sampling time when <code class="language-plaintext highlighter-rouge">data_extract</code> was generated</li>
    </ul>
  </li>
  <li>an <code class="language-plaintext highlighter-rouge">animate.R</code> Rscript that you can call to generate animations of the simulations.</li>
</ul>

<h2 id="running-the-spatial-process">Running the spatial process</h2>

<p>Run the following in a terminal:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>model_1 --config examples/config_1.ctl --landscape examples/australia_precipitation_6032.tif
</code></pre></div></div>

<p>You should see in the terminal if the demographic
history has been simulated, then a not-functional-anymore progress bar,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--- Expanding demography
--- Simulating coalescents

0%   10   20   30   40   50   60   70   80   90   100%
|----|----|----|----|----|----|----|----|----|----|
--- Genealogies in Newick format:

((18:296953680,(((19:8,16:8):475,(7:4,8:4):479):156533027,((23:27,25:27):354,(11:268,(27:134,4:134):134):113):156533129):140420170):542315996,((((29:17,2:17):57,(5:9,3:9):65):1407153652,((6:1,9:1,(14:0,15:0):1):834405852,(22:497,((((1:4,0:4):54,10:58):91,(6:1,13:1):148):134,(21:0,17:0):283):214):834405356):572747873):995549076,((((56:53,(48:6,37:6):47):285,(45:2,(41:1,40:1,39:1):1):336):22,(43:240,(58:110,((34:11,36:11):4,(30:14,47:14):1):95):130):120):121,(((26:72,(24:68,28:68):4):377,(((59:2,57:2):309,42:311):66,(31:333,(((46:1,51:1):304,((((41:1,44:1):49,(49:0,50:0):50):3,32:53):110,((38:84,52:84):4,55:88):75):142):9,((53:0,54:0):7,(33:3,35:3):4):307):19):44):72):12,(20:31,12:31):430):20):1892264975):1646902178);

</code></pre></div></div>

<p>The program outputs in a databse as many gene trees in Newick format as they are loci, with each node being represented
by a gene copy ID and the branch length in generations.</p>

<p>As many <code class="language-plaintext highlighter-rouge">Imap</code> files as they are simulations are also printed, mapping each gene copy to a sampling cluster, that is a putative population/species for BPP.</p>

<p>The program generates a bunch of files in the <code class="language-plaintext highlighter-rouge">output</code> directory giving access
to various aspects of the demographic process. We will look to the demographic process more in details
in the second part.</p>

<h2 id="demographic-process">Demographic process</h2>

<p>Run the following:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>model_1 --config examples/config_1.ctl --landscape examples/australia_precipitation_6032.tif
./animate.R output/N.tif 100
</code></pre></div></div>

<p>We are giving this time a different configuration file to spatial_process. Its content should be:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>landscape=../decrypt/example/australia_precipitation_6032.tif
n_sim_gen=5
n_loci=5
lat_0=-20.0
lon_0=125.0
N_0=1000
duration=500
lat_1=-20.0
lon_1=125.0
n_sample_1=30
radius_sample_1=30.0
n_sample_2=30
radius_sample_2=30.0
sampling_threshold=30
suitability_threshold=26.4
K_max=50
p=0.2
K_min_a=15
K_min_b=50
r=1
emigrant_rate=0.5
friction_suitable=0.4
friction_unsuitable=0.6
demography_out=output/N.tif
last_layer_out=output/last_N.tif
distribution_area_out=output/distribution_area.shp
mask_out=output/mask.shp
sample_out=output/sample.shp
database=output/test.db
</code></pre></div></div>

<p>At the bottom of this page, there is an equivalent file with comment documenting the
meaning of the parameters. We are here mostly interested in changing values from
the <code class="language-plaintext highlighter-rouge">suitability_threshold</code> to the <code class="language-plaintext highlighter-rouge">friction_unsuitable</code> options, configuring
the demographic process.</p>

<h3 id="demographic-model">Demographic model</h3>

<p>In its present version, the demographic model considers that the landscape is divided
into <em>suitable</em> and <em>unsuitable</em> areas. Suitable areas are locations where the value
of the landscape is greater than a threshold. Suitable areas are characterized by
higher carrying capacity $K_{max}$ and a facilitated migration. Unsuitable areas have most of the time a low carrying capacity $K_{min}^a$,
but with probability $p$ a location can switch to a higher $K_{min}^b$.</p>

<p>We may surely develop
a simpler alternative model, but in its current state it allows
to simulate interesting patterns of population persistence in unsuitable areas.</p>

<p>The growth rate is assumed constant across the landscape, as well as the emigrant rate.</p>

<p>This configuration allow to generate the following demgoraphic history.</p>

<blockquote>
  <p>You may need google chrome to be able to see this movie</p>
</blockquote>

<video src="../demo/decrypt/movie2.mp4" width="640" height="400" controls="" preload=""></video>

<p>Change the value options to generate different histories. Lower $p$ will be, the more
the demographic expansion will be constrained to suitable areas.</p>

<h2 id="visualize-pre-computed-results">Visualize pre-computed results</h2>

<h3 id="sampling-scheme">Sampling scheme</h3>

<p>In the spatial process configuration file, we limited the number of simulations to
5 sampling schemes, each one composed of:</p>
<ul>
  <li>1 sampling cluster fixed on a given coordinate</li>
  <li>1 sampling cluster that varies uniformly across the distribution area</li>
</ul>

<p>Within a radius of 30km each of these coordinates, 30 individuals are sampled uniformly.
These parameters can be change in the <code class="language-plaintext highlighter-rouge">spatial_process.ctl</code> configuration file.</p>

<p>First this script allows to generate a plot <code class="language-plaintext highlighter-rouge">sampling_scheme.png</code> representing the fixed sampling cluster, in red, and the
5 varying clusters with their respective radius, in black, on top of the spatial
distribution of the population sizes at sampling time, in colors.</p>

<p><img src="../demo/decrypt/sampling_2.jpeg" alt="alt text" title="Sampling schemes simulated" /></p>

<p>We find these kind of plots useful to configure the sampling scheme properties. The R script also generates visualization of the BPP robustness analysis.</p>

<h3 id="posterior-probability">Posterior probability</h3>

<p>To visualize the combined effects of departures from the MSC model hypothesis and
sampling scheme, you can either look at the raw posterior probabilities, or perform
a spatial interpolation of this probability.</p>

<p>The script generated a plot <code class="language-plaintext highlighter-rouge">raw_posterior_probability.png</code> representing
at the location of population $P_2$ the posterior probability of detecting more than 1 species by BPP.</p>

<p><img src="../demo/decrypt/raw_posterior_probability.png" alt="alt text" title="More sampling schemes simulated" /></p>

<p>A spatial interpolation of these probabilities is also generated by the R script, and
saved as <code class="language-plaintext highlighter-rouge">interpolation.png</code>
<img src="../demo/decrypt/interpol_2.jpeg" alt="alt text" title="Spatial interpolation of the probability to detect more than one species" /></p>

<p>This plot give an interesting overview of what we should expect BPP to infer under
a spatial history.</p>

</div>

  </div>
  <!-- We want analytics -->
  <!-- Enables suupport for Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-106771332-1', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>

</html>
